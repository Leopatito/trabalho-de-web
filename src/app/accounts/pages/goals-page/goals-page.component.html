<div class="goals-page-container" [class.sidebar-collapsed]="isCollapsed">
  <header class="topbar">
    <div class="left-area">

      <div class="brand">Finanças Pessoais</div>
    </div>

  </header>
  <nav class="sidebar" [class.collapsed]="isCollapsed">
    <div class="sidebar-content">
    
      <button class="toggle-btn" (click)="toggleSidebar()">
        <span class="material-icons">{{ isCollapsed ? 'menu' : 'close' }}</span>
      </button>

      <a routerLink="/dashboard" class="nav-item">
        <span class="material-icons">home</span>
        <span class="label">Dashboard</span>
      </a>

      <a routerLink="/accounts" class="nav-item">
        <span class="material-icons">account_balance_wallet</span>
        <span class="label">Minhas Contas</span>
      </a>

      <a routerLink="/goals" routerLinkActive="active" class="nav-item">
        <span class="material-icons">receipt_long</span>
        <span class="label">Metas</span>
      </a>

      <a routerLink="/profile" class="nav-item">
        <span class="material-icons">person</span>
        <span class="label">Perfil</span>
      </a>

      <button class="nav-item logout" (click)="onLogout()">
        <span class="material-icons">logout</span>
        <span class="label">Sair</span>
      </button>

    </div>
  </nav>

  <!-- CONTEÚDO DA PÁGINA -->
  <div class="goals-container">

    <div class="header">
      <h1><i class="fa-solid fa-bullseye"></i> Minhas Metas</h1>

      <button class="btn-add" type="button" (click)="openModal()">
        <i class="fa-solid fa-plus"></i> Nova Meta
      </button>
    </div>

    <div *ngIf="loading" class="loading">
      <i class="fa-solid fa-spinner fa-spin"></i> Carregando...
    </div>

    <div *ngIf="error" class="error">
      <i class="fa-solid fa-circle-exclamation"></i> {{ error }}
    </div>

    <div *ngIf="goals.length === 0 && !loading" class="empty">
      <i class="fa-regular fa-folder-open"></i> Nenhuma meta encontrada.
    </div>

    <div class="goals-grid" *ngIf="goals.length > 0">
      <div *ngFor="let g of goals" class="goal-card">
        <div class="goal-header">
          <h3><i class="fa-solid fa-flag"></i> {{ g.description }}</h3>
          <span class="type">{{ g.type }}</span>
        </div>

        <p><strong>Progresso:</strong> {{ g.currentValue }} / {{ g.targetValue }}</p>
        <p><strong>Status:</strong> {{ g.status }}</p>

        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="g.progress"></div>
        </div>

        <div class="dates">
          <p><i class="fa-solid fa-calendar-day"></i> Início: {{ g.startDate | date }}</p>
          <p><i class="fa-solid fa-calendar-check"></i> Fim: {{ g.endDate | date }}</p>
        </div>

        <button class="btn-add-value" (click)="openAddValueModal(g)">
          <i class="fa-solid fa-coins"></i> Adicionar valor
        </button>

        <button class="delete-btn" (click)="deleteGoal(g.id)">
          <i class="fa-solid fa-trash"></i> Excluir
        </button>

      </div>
    </div>
  </div>

</div>

<!-- MODAL NOVA META -->
<div class="backdrop" *ngIf="modalOpen" (click)="closeModal()"></div>

<div class="modal" *ngIf="modalOpen" (click)="$event.stopPropagation()">
  <h2><i class="fa-solid fa-plus"></i> Nova Meta</h2>

  <label>Descrição</label>
  <input type="text" [(ngModel)]="goalForm.description">

  <label>Valor objetivo</label>
  <input type="number" [(ngModel)]="goalForm.targetValue">

  <label>Data início</label>
  <input type="date" [(ngModel)]="goalForm.startDate">

  <label>Data final</label>
  <input type="date" [(ngModel)]="goalForm.endDate">

  <label>Tipo da meta</label>
  <select [(ngModel)]="goalForm.type">
    <option value="POUPANCA">Poupança</option>
    <option value="DIVIDA">Dívida</option>
    <option value="COMPRA">Compra</option>
    <option value="ORCAMENTO">Orçamento</option>
    <option value="INVESTIMENTO">Investimento</option>
  </select>

  <div class="actions">
    <button class="cancel" (click)="closeModal()">
      <i class="fa-solid fa-xmark"></i> Cancelar
    </button>
    <button class="save" (click)="saveGoal()">
      <i class="fa-solid fa-check"></i> Salvar
    </button>
  </div>
</div>

<!-- MODAL ADICIONAR VALOR -->
<div class="backdrop" *ngIf="addValueModalOpen" (click)="closeAddValueModal()"></div>

<div class="modal" *ngIf="addValueModalOpen" (click)="$event.stopPropagation()">
  <h2><i class="fa-solid fa-wallet"></i> Adicionar valor</h2>

  <p>Meta: <strong>{{ selectedGoal?.description }}</strong></p>

  <label>Conta</label>
  <select [(ngModel)]="selectedAccountId">
    <option *ngFor="let a of accounts" [value]="a.id">{{ a.name }}</option>
  </select>

  <label>Valor</label>
  <input type="number" [(ngModel)]="valueToAdd">

  <div class="actions">
    <button class="cancel" (click)="closeAddValueModal()">
      <i class="fa-solid fa-xmark"></i> Cancelar
    </button>
    <button class="save" (click)="confirmAddValue()">
      <i class="fa-solid fa-check"></i> Adicionar
    </button>
  </div>
</div>
